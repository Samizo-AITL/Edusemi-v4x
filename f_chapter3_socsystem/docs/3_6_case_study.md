# 3.6 ケーススタディ：三層制御によるPoC実装例

## 🎯 本節の目的

本章で解説した三層制御構造（FSM・PID・LLM）を実際に組み合わせて実装し、  
SoC上でどのように動作するかを具体例で検証します。

---

## 🧪 ケース①：倒立振子の安定化制御

### 📌 構成概要

| 層 | 実装内容 |
|----|----------|
| FSM | 倒立振子の起動・停止・落下状態遷移を管理 |
| PID | 角度センサからの値に基づいてトルクを制御 |
| LLM | ユーザ命令（例："止まって"）に基づいてFSMを指示 |

### 🌀 状態遷移例（FSM）

IDLE → INIT_BALANCE → STABILIZING → FALLEN

### 🔁 制御ループ

1. FSMが「起動」状態を認識
2. PIDがリアルタイムに角度補正を行い、倒立維持
3. LLMが「停止命令」を出せばFSMが STOP 状態へ

---

## 🤖 ケース②：人型ロボットの立ち上がり・旋回制御

### 📌 構成概要

| 層 | 実装内容 |
|----|----------|
| FSM | 行動パターン（立ち上がり、旋回、停止）を管理 |
| PID | サーボの角度・速度を連続制御 |
| LLM | 「方向転換」などの指令を自然言語から抽出しFSMに伝達 |

### 💡 特徴的な設計ポイント

- LLMが命令を自然言語で受け取り → FSMへマップ変換
- FSMはそれに基づき状態遷移
- PIDは歩行・旋回ごとに別の目標角度で連続制御

---

## 🧭 評価指標の例

| 指標 | 評価内容 |
|------|----------|
| 安定性 | PID出力の発振や過渡応答 |
| 応答性 | FSMの状態遷移速度、LLM介入のレイテンシ |
| 柔軟性 | LLMによる指令変更の適応能力 |
| 拡張性 | 状態・モードの追加による再設計コスト |

---

## 📝 実装と評価のヒント

- トレースログを取り、FSM状態・PID出力・LLM命令を時系列で比較
- LLMを使った制御の場合、**「介入のタイミングと粒度」**が鍵
- FSM・PIDそれぞれが**LLM非依存でも機能**するように設計すべき

---

## 📦 関連PoC構成例（GitHub）

- [`AITL-H/PoC/`](https://github.com/Samizo-AITL/AITL-H/tree/main/PoC)：FSM/PID/LLMの接続済みサンプル
- [`AITL-H/implementary/`](https://github.com/Samizo-AITL/AITL-H/tree/main/implementary)：各層の制御実装コード

---

## ✅ まとめと次の展開

- FSM×PID×LLMによる統合制御は、「反応＋安定＋判断」を組み合わせた強力な構造
- SoC上にモジュール化すれば、多様なシステムへ再利用可能
- 次章以降では、**OpenLane等による物理設計**や**自動化設計補助**への展開が可能

---
