# 3.1 AITL-Hアーキテクチャと層分離設計

## 🧠 AITL-Hとは何か？

AITL-H（All-in-Theory Logic - Hybrid）は、制御系を以下の**三層構造**で捉える設計パラダイムです。

| 層 | 役割 | 例 |
|----|------|----|
| LLM（知性） | 意図・推論・判断 | 対話、計画、最適化 |
| PID（理性） | 安定化・物理調整 | モーター制御、姿勢制御 |
| FSM（本能） | 行動スイッチ | 移動開始、旋回、停止 |

このように各層の責務を**機能分離（separation of concerns）**することで、設計の明確化と再利用性を向上させます。

---

## 🏗 三層構造の接続イメージ（ブロック図）
    +-----------------+
    |      LLM層      | ← GPT・RISC-V等が判断・命令
    +--------+--------+
             ↓ command / override
    +--------+--------+
    |      PID層      | ← 振動抑制、位置安定化
    +--------+--------+
             ↑ error feedback
    +--------+--------+
    |      FSM層      | ← 本能的行動切替（状態）
    +-----------------+
- FSM：センサ信号に反応し、行動モードを切替
- PID：FSMまたはLLMからの目標値 `ref` に基づき連続制御
- LLM：シナリオや環境変化に応じて制御構造に介入（override）

---

## 🎯 なぜ分離するのか？

| 項目 | 分離しない場合 | 分離した場合（AITL-H） |
|------|----------------|--------------------------|
| 実装の再利用 | 状態と制御が混在 | FSM/PID/LLMを個別再利用可能 |
| 保守性 | 修正が全体に波及 | 層ごとに独立性が高い |
| AI導入性 | 統合困難 | LLM層だけをAI化可能 |

> 特にSoC実装においては、**ハード制御（FSM/PID）とソフト制御（LLM）の分離**が極めて重要です。

---

## 🔗 SoC設計における三層のマッピング

| 層 | 実装対象 | ハード or ソフト |
|----|----------|------------------|
| FSM | Verilog RTL | ハード |
| PID | RTL or アナログ回路 | ハード（混載可） |
| LLM | RISC-V上のC/LLM | ソフト（外部マスター） |

---

## 💡 設計上の要点

- **FSM・PIDはリアルタイム性を優先**
- **LLMは非リアルタイムでも高次判断可能**
- すべての層で**明示的なインターフェース**（例：ref, u_out, action_out）を設計

---

## 📎 次節との接続

次の「**3.2 FSM設計とRTLモジュール構成**」では、  
この三層構造の最下層である**FSMの状態設計とRTL化**について詳細に解説します。

---

