# 3.5 SoCçµ±åˆã¨ãƒã‚¹æ§‹é€ ãƒ»é€šä¿¡è¨­è¨ˆ

## ğŸ§© çµ±åˆè¨­è¨ˆã®ç›®çš„

FSMãƒ»PIDãƒ»LLMã®ä¸‰å±¤åˆ¶å¾¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã€1ã¤ã®SoCã¨ã—ã¦çµ±åˆã™ã‚‹éš›ã«å¿…è¦ãªè¨­è¨ˆã¯ï¼š

- å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®**æ˜ç¢ºãªå½¹å‰²åˆ†é›¢ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©**
- **é€šä¿¡ãƒã‚¹**ã‚’ç”¨ã„ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“æ¥ç¶šï¼ˆAXI, APBç­‰ï¼‰
- ãƒˆãƒƒãƒ—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã®**æ¥ç¶šã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã®ç¢ºä¿**

---

## ğŸ— SoCå…¨ä½“æ§‹æˆãƒ–ãƒ­ãƒƒã‚¯å›³ï¼ˆæ¦‚å¿µï¼‰
```
    +-----------------------------+
    |           SoC Top          |
    |                             |
    |   +---------+   +--------+  |
    |   |   FSM   |â†â†’|  PID    |  |
    |   +----+----+   +--------+  |
    |        â†‘                â†‘   |
    |        | action_out     | u_out
    |        â†“                â†“
    |     +-----------------------+
    |     |      LLM Interface    | â†â†’ RISC-V CPU
    |     +-----------------------+
    |            â†‘   â†‘
    |         MMIO  IRQ
    +-----------------------------+

    ---
```

---

## ğŸ“¡ ãƒã‚¹æ¥ç¶šæ–¹å¼ã®é¸æŠè‚¢

| ãƒã‚¹ç¨®åˆ¥ | ç”¨é€” | ãƒ¡ãƒªãƒƒãƒˆ | å‚™è€ƒ |
|----------|------|----------|------|
| AXI4 | é«˜é€ŸSoCè¨­è¨ˆå…¨èˆ¬ | é«˜å¸¯åŸŸãƒ»è¤‡æ•°ãƒã‚¹ã‚¿ãƒ¼å¯¾å¿œ | LLM/RISC-V â†” MMIO |
| APB | å‘¨è¾ºãƒ‡ãƒã‚¤ã‚¹åˆ¶å¾¡ | ç°¡æ˜“æ§‹æˆãƒ»ä½é›»åŠ› | FSM, PID æ¥ç¶šã«é© |

> æ•™æè¨­è¨ˆã§ã¯ã€ã€ŒRISC-Vãƒã‚¹ã‚¿ãƒ¼ + AXI + APBãƒ–ãƒªãƒƒã‚¸ + FSM/PIDã‚¹ãƒ¬ãƒ¼ãƒ–ã€ã®æ§‹æˆã‚’æ¨å¥¨

---

## ğŸ”„ æ¥ç¶šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ä¿¡å·æ•´ç†

| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | ä¸»ãªãƒãƒ¼ãƒˆ | æ¥ç¶šå…ˆ |
|------------|------------|--------|
| FSM | `clk`, `rst`, `sensor_in`, `action_out` | Top, Sensor, PID |
| PID | `clk`, `rst`, `ref`, `y`, `u_out` | FSM, Actuator |
| LLM I/F | `llm_action`, `llm_ref`, `mode` | RISC-V â†” FSM/PID |
| RISC-V SoC | AXI Master | LLM I/FçµŒç”±ã§åˆ¶å¾¡ |

---

## âš™ï¸ ãƒˆãƒƒãƒ—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¨­è¨ˆä¾‹ï¼ˆæŠœç²‹ï¼‰

```verilog
module soc_top (
    input wire clk,
    input wire rst,
    input wire [3:0] sensor_data,
    input wire [15:0] y_feedback,
    output wire [15:0] actuator_out
);
    // FSMã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
    wire [2:0] action_out;
    fsm_engine fsm_inst (
        .clk(clk),
        .rst(rst),
        .sensor_in(sensor_data),
        .action_out(action_out)
    );

    // PIDã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
    wire [15:0] ref;
    pid_controller pid_inst (
        .clk(clk),
        .rst(rst),
        .ref(ref),
        .y(y_feedback),
        .u_out(actuator_out)
    );

    // LLM I/Fï¼ˆMMIOæ¥ç¶šæƒ³å®šï¼‰
    llm_interface llm_if (
        .llm_action_in(mmio_action),
        .llm_ref_in(mmio_ref),
        .fsm_action_out(action_out),
        .pid_ref_out(ref)
    );

endmodule
```

---

## ğŸ“ çµ±åˆè¨­è¨ˆã®æ³¨æ„ç‚¹
	â€¢	ãƒã‚¹ã‚¯ãƒ­ãƒƒã‚¯ã¨åˆ¶å¾¡ã‚¯ãƒ­ãƒƒã‚¯ã®ãƒ‰ãƒ¡ã‚¤ãƒ³æ•´åˆ
	â€¢	MMIOåˆ¶å¾¡ã¯ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·è¨±å®¹è¨­è¨ˆ
	â€¢	ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã¯ä¸­é–“ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã‚„FIFOè¨­è¨ˆã‚‚æ¤œè¨

---

## ğŸ“ æ¬¡ç¯€ã¨ã®æ¥ç¶š

æ¬¡ã¯ã€Œ3.6 ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ï¼šä¸‰å±¤åˆ¶å¾¡ã«ã‚ˆã‚‹PoCå®Ÿè£…ä¾‹ã€ã§ã™ã€‚
å®Ÿéš›ã«ã“ã®SoCæ§‹æˆã‚’ã‚‚ã¨ã«ã€FSMÃ—PIDÃ—LLMã«ã‚ˆã‚‹å€’ç«‹æŒ¯å­ã‚„ãƒ­ãƒœãƒƒãƒˆåˆ¶å¾¡ã®PoCå®Ÿè£…äº‹ä¾‹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

---
